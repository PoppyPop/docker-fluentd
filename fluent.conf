<source>
  @type  forward
  @id    input1
  @label @mainstream
  port  24224
</source>

<label @mainstream>
  <match nginx.docker.**>
    @type parser
    @id   output_nginx
    key_name log
    format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)" "(?<forwarded>[^\"]*)")?$/
    remove_prefix nginx
    reserve_data yes
  </match>
  
  <filter docker.**>
    @type concat
    @id   output_concat
    key log
    stream_identity_key container_id
    multiline_start_regexp /^-e:2:in `\/'/
    multiline_end_regexp /^-e:4:in/
  </filter>
  
  <match docker.**>
    @type elasticsearch
    @id   output_elastic
	host elastic1
	port 9200
	logstash_format true
	#user fluentd
	#password d2W4iV7W8dt9pYY9
  </match>
</label>
